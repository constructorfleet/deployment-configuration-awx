---

awx_inventory_name: DEV - PrettyBaked.com
awx_inventory_description: PrettyBaked.com Development Hosts
awx_host_config_key: 9931bad6-6526-4bf7-81b0-d56e67df3e00
awx_admin_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          65356234386564633839613038336338343263646339323733653237383933353366363965373438
          6133316230636136313736393833303963343565663233300a353738363532373665633234306337
          63366263663261303939646331313561386630356437653862633839323035393338643031643964
          6164663066626664390a326136633235393766326638333765323434663765376634386635373638
          3732

awx_task_container_name: awx-task
awx_task_container_hostname: awx
awx_web_container_name: awx-web
awx_web_container_hostname: awxweb

awx_notification_email: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34366534646564656233613832313761636632663566353239663738323735353164633839376535
          3832383836306362643536636265353231363530386631640a643930643731646138616335663961
          31363536333262373163356634646331373233613533383063393765323065383962343664663065
          3230373838663662650a396466393338313964363639326535626432373065353964373132393865
          64363164663336383364636330383631343834326162386538653430366662333237

awx_project_data_dir: /etc/ansible
awx_postgres_data_dir: /var/lib/pgawx

awx_pg_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          65393738386262666264343366613236616136653335313233646634323636343064656630646663
          6438613962646133616533643735363333663138643337330a643462656238336230313061303839
          64656463616463363931346264303465346165343136663838353630396636366634613937386537
          6431353133653333610a633130653166313332373634633835306135663935656634336364363564
          6363
awx_pg_admin_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37303764613763626337643866633835373539633433373564393930623337646632383931313632
          3630396338626536313336643965633265666462633537640a383364316461663836396232343734
          66313863386138623265643064366265636663626663303634303161396463393162343734313435
          3036393661663264390a653232383932633233366266393132323538336461623438393165366336
          6435

awx_secret_key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66343139336234623664653633643635633864363361333530323062623761386631363566633765
          6236303739373532343534666135376434656430306536320a626665663833646161646230303466
          61333037396537323739393462303036643030613132626436323036613734313036616366393339
          3837636236373839370a643630356361373032633966656439656335323163613839613530383536
          6661

awx_admin_user: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66663738633236616563346464303163376364663234313433626130313234663332386465323436
          3664663935356633626332633338643163653233383937350a626163616266373762396639353637
          35656166393634653261376538656330666564333931346132333533333663313737623834343538
          6239393061353437620a383539336364636637623630656565646437343734303133333763316434
          6666
awx_admin_passward: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63333236663864396130376362636637323438663637333161653965643166306433333261343665
          3865353064326432653430373433613432373433386132660a643064333138313964376564316137
          36636366646461393566393966623136643165663330333035626636343531386466333166343466
          6635343364353236330a656334353035363931666630346539653765313864353936646266366463
          6136
awx_github_deploy_key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39303062396632653639323130313330396261326364303965393937353739643535343838623339
          3965613264353463363638623332643361633566646364650a656432366462626531306135393833
          37663835333737306265366235653963343934323833303439623038666161643535323238383431
          3563366339313766360a306162356630353634663962316662643239666466373262666466373738
          33383961663564333530613334306535333939363439336333356463313435663837636538656462
          30396432303538376664303234623233356436633937393237303665336138393233663163383665
          64396634336130333666643134386166393833663637346361303063323633303066633434303336
          65633033376133356165316262313138326561396232333530663637393862626636383036396465
          34353936396563646433363035323935656137636231346664613134363835653463356638303536
          36316134613130303931313539383463333333643365353233333861636630643563323931643036
          30646237656637313163646662323032313333363734656161643165363863646366393537656465
          35343635373835323066333866623962323864303833613861643734323965323137386365353936
          33663635326265343266323337623161623062336162663630653466343136623365643535313437
          38633237656264643463333761613634616337386537323264613235396664623365386238336130
          35623064346661353363393831363333343962373334313966393437613130366164303363663666
          30383461636461333831373833316435633462353463363863316332386538343135306630613663
          63393737373033643335626566303265383465613139383435366239633561613365633234363733
          36363763613036623966346233343136333831306239643365306133666333326364626164663730
          39656639626564643033623539343164633361323635346263313934633865386232643039653066
          35343065313631396534393833316630343339363263636331396335303063613962363063376265
          63303535353032616636646662346231613065363864393736666133666364336634373338636332
          37343635373766323462666664356464303432303030366662323835623530616637333134343935
          62636132623664313139373430353833636333653639623536633464653039613461376538363030
          34333666626363386137303332383135336131656535376434353537633934313362663035336430
          31353865363363373330363239353233646464616165333334353236633666626433626635316532
          35323764346636666138623764303336346630396130323635356432343436643030333337326463
          31623737393034666230636631643761663339336531323263393964653163363061323331373866
          37373135666164383466356138656630373661393961373832396166663436326535373965313437
          38396464343065613766313936613532323133346639386166346534663732333463323238386436
          36626563316234366366396232336639666266316332363131383963373861383337646666373737
          33313634323939626464313234306665326638623462626466333064333262653937646638346631
          37626137333333323061636630366537373235343464356234623735343533356434356437663332
          36316430653336366563306565663464646666373264363432343931306333356366373564366335
          38383933346432316132656564306636363161303734376638323966396130333430656661373065
          62343939313366346236633536653863623665646330386466346666366630373136333662383138
          63316238663834383262363461346137366538316531663666663765373664613862313663303130
          39613335356339666230363866343435613531393831623064363536613235396131343763353264
          33383339343333663638613831626666356339323637323137303761363466666662383336313939
          34633230656661353832616663616364616235343862653638643234333435623362393466313734
          36323639356435633863333230383236623263646562613032376261333566363730313439636130
          63346336333236623638323539623564396134346338306662666437613032386538376666643666
          65353439393266356663323931633537323161393965323364366533386636303066653134633563
          66363731393761623539303032343533383438383265653563653663313165323764386337346462
          33663363666161366661613035363766353335663361323662303661333731316630363039653532
          62353363646132376166663636343564663732396566333231333038366263316264616237643763
          35663439376232336531316638303135663961646136646434336432643965313539306630383031
          66353935366531623665383135376134636463303765616533376233396234333137356535383130
          36663037376431616433363338323730656130343230303738643931303761363332653262663132
          66353636306266616664393131666237653532623966653936303139336565366138366233316231
          31353961366136623537626365666239663933383763656266633139613735353738336131303065
          37356134396663623437633832353636373461373963376164356231653232383438636264666164
          64353930353431636439393536393133663264336561636161396663353939633561643266646636
          61643062346233313333333161366339366336373239356130306331616135633838376432626439
          35626231383636393436343138346135646235323432343733323432323336636537313437356264
          32646238313237643733373461316436643230303433616630393162353039383765643661656533
          62313436623834386535313164643762376332353332623838363534356661366662356237623736
          66653938643130366335623338356538376339646139623763343161643435353738643863373033
          36623162313865626565383065656537363736316663306264396330373563393633646661636265
          63653964326463333339323864343361643666333237336532316165623938633563613738363335
          66393437623339346631386335306333613835666130306132666532313762613838373239613138
          62653938326636353432343134613835656231373061333539323839393537393366376432376566
          31343963616166663836343563623663643662306163363234643837353830336162383639663966
          61643931633138666234633731386162366465333532613666656534653464643264613764646333
          64633535666131623137376263333061383765656337633035383765346563306134333330373330
          35313530633464373533313635396364356533363865613566623362613165356534373364333132
          34643139363963663061353265633335646637646637643835626433386332396665626563613263
          65313361353732646266343038346561623665626232633061323966626464633437636334303965
          38333761343062336630313334646635366463646430653662356162363261623339393833356263
          37303435333733313831643261633032383739356332646435643063626561393437376336363838
          32303339383633346133333336643364623366353439636539643837343238313834356662653766
          37303239373132376137383639663564386639623039353664313833326134616166633739653831
          66663839363439613566623466346437386538306335653266396661333237393761353533363361
          61323330623664303138323064396634353134613036353235363134386534623261343631313531
          39343139363835633330383264666633396330306235336564646333323763333465323938643739
          34663331386561313439663333393339623363346531306137646539366464353861663031643866
          36383237623634613361303965633932666331653235386332333465363030386636636165363430
          30313733643661353530613132643362306330313066393461653562313338653962356338373232
          63626261323139623936363334613264623737303636363430323464633132373262373230353035
          30303136326564666564393033386433633734363437373732336663646334386365633032653134
          32313461356662323531646331623539663839346631353634663262643264323861666164356533
          37613963333838356663363064393266306236373530663032653332656638396438663032393032
          36666339323438653263636266646166643231653662396132383665393566636332386133383134
          66636533393437376431363638393165333163646563663636623437323331626436663363363836
          35643162386466666465323334666465303438336266386634666662386262623466653336373362
          66386366656634616239386133636364663731616232343231373461633938303565343734303536
          62346236313838666562666561393739386662323166316463633062383064373231626464303330
          36346235343836343136663264663336316234316363633136313331623866633261666135636332
          36386138393961333836

awx_postgresql_version: "10"
awx_postgresql_image: "postgres:{{ awx_postgresql_version }}"

awx_dockerhub_base: ansible
awx_dockerhub_version: 16.0.0
awx_create_preload_data: true

awx_docker_compose_dir: /var/lib/awxcompose
awx_pg_username: awx
awx_pg_database: awx
awx_pg_port: 5432

awx_web_hostname: awxweb
awx_task_hostname: awx

awx_organizations:
  - name: Default

awx_inventories:
  - name: '{{ awx_inventory_name }}'
    description: '{{ awx_inventory_description }}'
    organization: '{{ (awx_organizations | first)["name"] }}'

awx_inventory_plugins: []

awx_inventory_sources:
  - name: Foreman Hosts
    organization: Default
    inventory_name: '{{ awx_inventory_name }}'
    credential: Foreman
    kind: satellite6
    verbosity: 2
    update_on_launch: true

awx_credentials:
  - name: ansible-root
    credential_type: Machine
    inputs:
      ssh_key_data: '{{ lookup("file", "id_rsa_foreman_proxy") }}'
  - name: ansible-github
    credential_type: Source Control
    inputs:
      ssh_key_data: '{{ awx_github_deploy_key }}'
  - name: ansible-vault
    credential_type: Vault
    inputs:
      vault_id: 'ansible-vault'
      vault_password: '{{ vault_password }}'
  - name: Foreman
    credential_type: Red Hat Satellite 6
    inputs:
      username: "{{ foreman_username }}"
      password: "{{ foreman_password }}"
      host: "https://10.0.10.151"

awx_ldap_settings:
  - name: SESSION_COOKIE_AGE
    value: "28800"
  - name: AUTH_LDAP_SERVER_URI
    value: 'ldap://{{ ldap_authentication.host }}:389'
  - name: AUTH_LDAP_BIND_DN
    value: '{{ ldap_authentication.account }}'
  - name: AUTH_LDAP_GROUP_TYPE
    value: PosixGroupType
  - name: AUTH_LDAP_USER_SEARCH
    value:
      - '{{ ldap_authentication.users_base}}'
      - SCOPE_SUBTREE
      - (uid=%(user)s)
  - name: AUTH_LDAP_GROUP_SEARCH
    value:
      - '{{ ldap_authentication.groups_base }}'
      - SCOPE_SUBTREE
      - (objectClass=posixGroup)
  - name: AUTH_LDAP_USER_ATTR_MAP
    value:
      first_name: '{{ ldap_authentication.attr_firstname}}'
      last_name: '{{ ldap_authentication.attr_lastname }}'
      email: '{{ ldap_authentication.attr_mail }}'
  - name: AUTH_LDAP_GROUP_TYPE_PARAMS
    value:
      name_attr: cn
  - name: AUTH_LDAP_USER_FLAGS_BY_GROUP
    value:
      is_superuser:
        - 'cn=admin,{{ ldap_authentication.groups_base }}'
  - name: AUTH_LDAP_ORGANIZATION_MAP
    value:
      Default:
        admins: 'cn=admin,{{ ldap_authentication.groups_base }}'
        users: 'cn=users,{{ ldap_authentication.groups_base }}'
        remove_users: false
        remove_admins: false
  - name: AUTH_LDAP_TEAM_MAP
    value:
      LDAP Admins:
        users: 'cn=admin,{{ ldap_authentication.groups_base }}'
        organization: Default
        remove: false
      LDAP Users:
        users: 'cn=users,{{ ldap_authentication.groups_base }}'
        organization: Default
        remove: false
  - name: AUTH_LDAP_BIND_PASSWORD
    value: "{{ ldap_authentication.account_password }}"

awx_projects:
  - name: Provisioning and Deployment
    description: Provision, Deploy and Configuration of Systems
    scm_type: git
    scm_credential: ansible-github
    scm_clean: yes
    scm_branch: feature/ldap_auth
    scm_update_on_launch: no
    scm_url: git@github.com:constructorfleet/deployment-configuration-awx.git
    local_path: deployment-configuration-awx

awx_compose_project:
  - project_name: awx
    pull: yes

    definition:
      version: '3.5'
      x-logging: &default-logging
        driver: journald

      networks:
        awx:
          name: awx
          driver: bridge
          ipam:
            driver: default
            config:
              - subnet: 172.3.27.0/24

      services:
        redis:
          image: redis
          container_name: awx_redis
          restart: unless-stopped
          environment:
            http_proxy: "{{ http_proxy | default('') }}"
            https_proxy: "{{ https_proxy | default('') }}"
            no_proxy: "{{ no_proxy | default('') }}"
          command: ["/usr/local/etc/redis/redis.conf"]
          volumes:
            - "{{ awx_docker_compose_dir }}/redis.conf:/usr/local/etc/redis/redis.conf:ro"
            - "{{ awx_docker_compose_dir }}/redis_socket:/var/run/redis/:rw"
        postgres:
          container_name: awx-postgres
          image: postgres:10
          hostname: awx-postgres
          networks:
            awx:
              aliases:
                - postgres
                - awx_postgres
          volumes:
            - "{{ awx_postgres_data_dir }}/10/data/:/var/lib/postgresql/data/pgdata:Z"
          environment:
            POSTGRES_USER: "{{ awx_pg_username }}"
            POSTGRES_PASSWORD: "{{ awx_pg_password }}"
            POSTGRES_DB: "{{ awx_pg_database }}"
            PGDATA: "/var/lib/postgresql/data/pgdata"
            http_proxy: "{{ http_proxy | default('') }}"
            https_proxy: "{{ https_proxy | default('') }}"
            no_proxy: "{{ no_proxy | default('') }}"
          logging:
            << : *default-logging
            options:
              tag: awx-postgres

        web:
          container_name: awx-web
          image: "{{ awx_dockerhub_base }}/awx:{{ awx_dockerhub_version }}"
          depends_on:
            - redis
            - postgres
            - task
          ports:
            - "{{ awx_host_port }}:8052"
          networks:
            awx:
              aliases:
                - web
                - awxweb
                - awx_web
          hostname: awx-web
          user: root
          volumes:
            - "{{ awx_docker_compose_dir }}/SECRET_KEY:/etc/tower/SECRET_KEY"
            - "{{ awx_docker_compose_dir }}/environment.sh:/etc/tower/conf.d/environment.sh"
            - "{{ awx_docker_compose_dir }}/credentials.py:/etc/tower/conf.d/credentials.py"
            - "{{ awx_docker_compose_dir }}/nginx.conf:/etc/nginx/nginx.conf:ro"
            - "{{ awx_docker_compose_dir }}/redis_socket:/var/run/redis/:rw"
            - "{{ awx_project_data_dir }}:/var/lib/awx/projects:rw"
            - '/etc/localtime:/etc/localtime:ro'
          environment:
            http_proxy: "{{ http_proxy | default('') }}"
            https_proxy: "{{ https_proxy | default('') }}"
            no_proxy: "{{ no_proxy | default('') }}"
          logging:
            << : *default-logging
            options:
              tag: awx-web

        task:
          container_name: awx-task
          image: "{{ awx_dockerhub_base }}/awx:{{ awx_dockerhub_version }}"
          depends_on:
            - redis
            - postgres
          networks:
            awx:
              aliases:
                - task
                - awxtask
                - awx_task
                - awx-task
          hostname: awx
          user: root
          command: /usr/bin/launch_awx_task.sh
          volumes:
            - "{{ awx_docker_compose_dir }}/SECRET_KEY:/etc/tower/SECRET_KEY"
            - "{{ awx_docker_compose_dir }}/environment.sh:/etc/tower/conf.d/environment.sh"
            - "{{ awx_docker_compose_dir }}/credentials.py:/etc/tower/conf.d/credentials.py"
            - "{{ awx_docker_compose_dir }}/nginx.conf:/etc/nginx/nginx.conf:ro"
            - "{{ awx_docker_compose_dir }}/redis_socket:/var/run/redis/:rw"
            - "{{ awx_project_data_dir }}:/var/lib/awx/projects:rw"
            - '/etc/localtime:/etc/localtime:ro'
          environment:
            http_proxy: "{{ http_proxy | default('') }}"
            https_proxy: "{{ https_proxy | default('') }}"
            no_proxy: "{{ no_proxy | default('') }}"
          logging:
            << : *default-logging
            options:
              tag: awx-web